# 双系统故障排除

## 禁用 Fast Startup

Windows 下默认启用的 Fast Startup (快速启动) 可能会导致部分 Linux 下的功能异常. 启用了 Fast Startup 后:

- Windows 系统在关机前会缓存数据, 如果关机后 Linux 访问了 NTFS 分区, **可能**会导致缓存不一致, 造成数据丢失.  
- 有一定概率导致 Linux 启动后, 无线网卡无法正常工作.

    可能的临时解决方案:

    ```sh
    sudo rmmod iwlmvm
    sudo rmmod iwlwifi
    sudo modprobe iwlwifi
    ```

因此, 如果用户需要在 Linux 下访问 Windows 的 NTFS 分区, 或无线网卡存在异常, 建议禁用 Fast Startup.

运行 `control.exe /name Microsoft.PowerOptions /page pageGlobalSettings`, 然后禁用 `Turn on fast startup (recommended)`, 最后重启系统.

临时解决办法是让 Windows **重启**, 而非关机. 然后在重启时直接切换至 Linux.

## 时间不一致

这是由于位于主板上的硬件时钟 (Real-Time Clock, RTC) 不包含时区信息. 默认情况下, Linux 将 RTC 解读为 UTC 时间, 而 Windows 将其解读为本地时间.  
因此, 只要用户的本地时间与 UTC 时间不一致, 双系统的时间就会不一致.

有下面两种统一时间的解决方案:

- Windows 使用 UTC **(推荐)**

    ```bat
    reg add HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1
    ```

    然后重启系统.  

- Linux 使用本地时间
  
    ```sh
    # 方法 1 (待验证)
    timedatectl set-local-rtc 1 --adjust-system-clock # 使用 localtime
    sudo timedatectl                                  # 验证时间

    # 方法 2 (待验证)
    sudo timedatectl set-local-rtc 1
    sudo hwclock --localtime --systohc
    ```

## GRUB 被 Windows 更新覆盖

重新调整 BIOS 启动顺序.

## 参考

- <https://forum.archlinuxcn.org/t/topic/11549>
